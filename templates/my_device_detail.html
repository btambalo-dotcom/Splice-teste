{% extends "base.html" %}
{% block title %}Dispositivo: {{ device_name }}{% endblock %}
{% block content %}
<h1>Dispositivo: {{ device_name }}</h1>

<form method="get" action="{{ url_for('my_device_detail', device_name=device_name) }}">
  <div style="display:grid; grid-template-columns: repeat(3, minmax(140px,1fr)); gap:12px; max-width:720px;">
    <div>
      <label>Início</label>
      <input type="date" name="start" value="{{ start }}">
    </div>
    <div>
      <label>Fim</label>
      <input type="date" name="end" value="{{ end }}">
    </div>
    <div style="align-self:end;">
      <button class="btn" type="submit">Filtrar</button>
    </div>
  </div>
</form>

<p><strong>Total de fusões no período:</strong> {{ total }}</p>

<h2>Registros</h2>
{% if rows %}
  <table class="table">
    <tr><th>ID</th><th>Fusões</th><th>Criado em</th><th>Ações</th></tr>
    {% for r in rows %}
      <tr>
        <td>{{ r.id }}</td>
        <td>{{ r.fusion_count }}</td>
        <td>{{ r.created_at }}</td>
        <td>
          <a class="btn" href="{{ url_for('view_record', record_id=r.id) }}">Ver</a>
          <a class="btn secondary" href="{{ url_for('edit_record', record_id=r.id) }}">Editar</a>
        </td>
      </tr>
    {% endfor %}
  </table>
{% else %}
  <p>Sem registros.</p>
{% endif %}

<h2>Fotos</h2>
{% if photos %}
  <div class="thumbs">
    {% for p in photos %}
      <img class="zoomable" src="{{ url_for('uploaded_file', filename=p['filename']) }}" alt="foto" data-full="{{ url_for('uploaded_file', filename=p['filename']) }}">
    {% endfor %}
  </div>
{% else %}
  <p>Sem fotos.</p>
{% endif %}

<div id="lightbox" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.85); align-items:center; justify-content:center; z-index:9999;">
  <img id="lightbox-img" src="" style="max-width:90%; max-height:90%; border-radius:8px;">
</div>
<script>
  document.querySelectorAll('.zoomable').forEach(img => {
    img.addEventListener('click', () => {
      document.getElementById('lightbox-img').src = img.dataset.full;
      document.getElementById('lightbox').style.display = 'flex';
    });
  });
  document.getElementById('lightbox').addEventListener('click', () => {
    document.getElementById('lightbox').style.display = 'none';
  });
</script>

<p style="margin-top:16px;"><a class="btn secondary" href="{{ url_for('my_reports', start=start, end=end, device=device_name) }}">Voltar</a></p>
{% endblock %}
