<!doctype html><title>Relatórios</title>
<h2>Relatórios (Admin)</h2>
<form method="get" action="/reports">
  Início: <input type="date" name="start" value="{{ start }}">
  Fim: <input type="date" name="end" value="{{ end }}">
  Usuário: <select name="user_id">
    <option value="">Todos</option>
    {% for u in users %}
      <option value="{{ u.id }}" {% if user_id and user_id|int == u.id %}selected{% endif %}>{{ u.username }} (#{{u.id}})</option>
    {% endfor %}
  </select>
  <button type="submit">Filtrar</button>
  <a href="/reports/export?start={{ start }}&end={{ end }}&user_id={{ user_id }}">Exportar CSV</a>
</form>
<p><b>Total de dispositivos:</b> {{ total_devices }} — <b>Total de fusões:</b> {{ total_fusions }}</p>
<table border="1" cellpadding="6" cellspacing="0">
  <tr><th>ID</th><th>Dispositivo</th><th>Fusões</th><th>Usuário</th><th>Data/Hora</th><th>Lançado</th></tr>
  {% for r in records %}
  <tr>
    <td>{{ r.id }}</td>
    <td>{{ r.name }}</td>
    <td>{{ r.fusion_count }}</td>
    <td>{{ r.user_id }}</td>
    <td>{{ r.timestamp.strftime("%Y-%m-%d %H:%M") }}</td>
    <td>{{ "sim" if r.released else "não" }}</td>
  </tr>
  {% endfor %}
</table>
